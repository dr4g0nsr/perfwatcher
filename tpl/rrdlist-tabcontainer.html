{**
 * Common functions
 *
 * PHP version 5
 *
 * LICENSE: This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 * @category  Monitoring
 * @author    Cyril Feraudet <cyril@feraudet.com>
 * @copyright 2011 Cyril Feraudet
 * @license   http://www.gnu.org/copyleft/lesser.html  LGPL License 2.1
 * @link      http://www.perfwatcher.org/
 *} 
<script type="text/javascript">
    var alreadyshowed{$time}{$pluginid} = false;
    var selected_graphs{$time}{$pluginid} = new Array();
    var selected_hosts{$time}{$pluginid} = new Array();
    {foreach item=host from=$tab_datas.selected_hosts}selected_hosts{$time}{$pluginid}.push('{$host}');{/foreach}
    {foreach item=graph from=$tab_datas.selected_graph}selected_graphs{$time}{$pluginid}.push('{$graph}');{/foreach}
{literal}
	function tabs_{/literal}{$time}{$pluginid}{literal}() {
        if (alreadyshowed{/literal}{$time}{$pluginid}{literal}) { return; }
        alreadyshowed{/literal}{$time}{$pluginid}{literal} = true;
		$.getJSON('index.php?tpl=hostslist&parentid={/literal}{$nodeid}{literal}', function(data) {
            $.each(data, function(key, val) {
                var selected = jQuery.inArray(val, selected_hosts{/literal}{$time}{$pluginid}{literal}) != -1 ? true : false;
                $('<option'+(selected ? ' selected="selected"' : '')+'>'+val+'</option>').appendTo('#select_hosts_tab_{/literal}{$pluginid}{literal}');
                $('<div class="custom_host" host="'+val+'"></div>').appendTo('#tabs-{/literal}{$pluginid}{literal}');
            });
            $('#select_hosts_tab_{/literal}{$pluginid}{literal}').multiselect({ noneSelectedText: 'Select host(s)', selectedList: 0 }).multiselectfilter();
            $('#select_plugins_tab_{/literal}{$pluginid}{literal}').multiselect({ noneSelectedText: 'Select plugin(s)', selectedList: 0 }).multiselectfilter();
        });
    }
    $('#filter{/literal}{$time}{$pluginid}{literal}').button().click(function(){
        var host_list = new Array();
        $('#select_hosts_tab_{/literal}{$pluginid}{literal} option:selected').each(function(){
            host_list.push($(this).val());
        });
        $('#select_plugins_tab_{/literal}{$pluginid}{literal} option').remove();
		$.getJSON('index.php?tpl=pluginslist', { parentid : host_list }, function(data) {
            $.each(data, function(key, val) {
                var selected = jQuery.inArray(val[0]+'|'+val[1]+'|'+val[2]+'|'+val[3], selected_graphs{/literal}{$time}{$pluginid}{literal}) != -1 ? true : false;
                $('<option value="'+val[0]+'|'+val[1]+'|'+val[2]+'|'+val[3]+'"'+(selected ? ' selected="selected"' : '')+'>'+val[4]+'</option>').appendTo('#select_plugins_tab_{/literal}{$pluginid}{literal}');
            });
            $('#select_plugins_tab_{/literal}{$pluginid}{literal}').multiselect('refresh');
        });
    });
    $('#apply{/literal}{$time}{$pluginid}{literal}').button().click(function(){
        $('#tabs-{/literal}{$pluginid}{literal} div[host]').each(function(){
            $(this).html('');
        });
        var i = 0;
        $('#select_hosts_tab_{/literal}{$pluginid}{literal} option:selected').each(function(){
            var hostselected = $(this).val();
            $('#select_plugins_tab_{/literal}{$pluginid}{literal} option:selected').each(function(){
                var pluginselected = $(this).val().split('|');
                add_graph('tabs-{/literal}{$pluginid}{literal} div[host='+hostselected.replace(',', '\\,')+']', hostselected, pluginselected[0], pluginselected[1], pluginselected[2], pluginselected[3], 'g{/literal}{$time}{$pluginid}{literal}'+i);
                i++;
            });
        });
    });
    $('#save{/literal}{$time}{$pluginid}{literal}').button().click(function(){
        var hosts = new Array();
        var plugins = new Array();
        $('#select_hosts_tab_{/literal}{$pluginid}{literal} option:selected').each(function(){
            hosts.push($(this).val());
        });
        $('#select_plugins_tab_{/literal}{$pluginid}{literal} option:selected').each(function(){
            plugins.push($(this).val());
        });
        $.ajax({
            async : false, type: 'POST', url: "index.php?tpl=rrdlist",
            data : { "action" : "save_tab", "id" : {/literal}{$nodeid}{literal}, "tab_id" : '{/literal}{$tab_id}{literal}', 'selected_graph' : plugins, 'selected_hosts' : hosts },
            complete : function (r) {
                if(!r.status) { ('#content').html('Error, can\'t retrieve data from server !'); }
                else { $('#content').html(r.responseText); refresh_status(); }
                }
        });
    });
{/literal}
</script>

<select multiple="multiple" id="select_hosts_tab_{$pluginid}">
</select>
<button id="filter{$time}{$pluginid}" tabid="{$tab_id}">Show plugins &gt;</button>
<select multiple="multiple" id="select_plugins_tab_{$pluginid}">
</select>
<br />
<button id="apply{$time}{$pluginid}" tabid="{$tab_id}">Apply</button>
<button id="save{$time}{$pluginid}" tabid="{$tab_id}">Save</button>
<button class="deletetab" tabid="{$tab_id}">Delete tab</button>
<br/><br/>
