{**
 * Common functions
 *
 * PHP version 5
 *
 * LICENSE: This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 * @category  Monitoring
 * @author    Cyril Feraudet <cyril@feraudet.com>
 * @copyright 2011 Cyril Feraudet
 * @license   http://www.gnu.org/copyleft/lesser.html  LGPL License 2.1
 * @link      http://www.perfwatcher.org/
 *} 
<script type="text/javascript">
{literal}
    var graph_id = 0;
    var alreadyshowed{/literal}{$pluginid}{literal} = false;
    function tabs_{/literal}{$time}{$pluginid}{literal}() {
        if (alreadyshowed{/literal}{$pluginid}{literal}) { return; }
        alreadyshowed{/literal}{$pluginid}{literal} = true;
        var str = '{/literal}{$tab_datas.selected_graph}{literal}';
        var strarr = str.split(',');
        for (graphattr in strarr) {
            var graph = strarr[graphattr].split('|');
            add_graph('tabs-{/literal}{$pluginid}{literal}', '{/literal}{$host}{literal}', graph[0], graph[1], graph[2], graph[3], '{/literal}{$pluginid}{literal}' + graph[0] + graph_id);
            graph_id++;
        }
        $('#select_tabs_{/literal}{$pluginid}{literal} option').each(function() {
            for (graphattr in strarr) {
                if (strarr[graphattr] == $(this).val()) {
                    $(this).attr('selected', 'selected');
                }
            }
        });
        $('#select_tabs_{/literal}{$pluginid}{literal}').multiselect({ noneSelectedText: 'Select plugin(s)', selectedList: 2 }).multiselectfilter();
    }
    $('#select_tabs_{/literal}{$pluginid}{literal}').click(function () {
        $('.graph_float').each(function() {
            if($(this).attr("parenttab") == 'tabs-{/literal}{$pluginid}{literal}') {
                $(this).hide('slow');
            }
        });
        $('#select_tabs_{/literal}{$pluginid}{literal} option:selected').each(function() {
            var names = $(this).val().split('|');
            graphok = false;
            $(".graph_image").each(
                function(index) {
                    if ($(this).attr("parenttab") != 'tabs-{/literal}{$pluginid}{literal}') { return; }
                    if (
                           $(this).attr("plugin_name") == names[0] 
                        && $(this).attr("plugin_instance_name") == names[1]
                        && $(this).attr("type_name") == names[2]
                        && $(this).attr("type_instance_name") == names[3]
                        ) {
                        graphok = true;
                        $(this).parent().show('slow');
                    }
                }
            ); 
            if(!graphok) {
                add_graph('tabs-{/literal}{$pluginid}{literal}', '{/literal}{$host}{literal}', names[0], names[1], names[2], names[3], '{/literal}{$pluginid}{literal}' + names[0] + graph_id);
                graph_id++;
            }
        });
    });
    $('#save_tabs_{/literal}{$pluginid}{literal}').button().click(function () {
        var str = '';
        $('#select_tabs_{/literal}{$pluginid}{literal} option:selected').each(function() {
            if (str != '') { str = str + ','; }
            str = str + $(this).val();
        });
        $.ajax({
            async : false, type: 'POST', url: "index.php?tpl=rrdlist",
            data : { "action" : "save_tab", "id" : {/literal}{$nodeid}{literal}, "tab_id" : '{/literal}{$tab_id}{literal}', 'selected_graph' : str },
            complete : function (r) {
                if(!r.status) { ('#content').html('Error, can\'t retrieve data from server !'); }
                else { $('#content').html(r.responseText); refresh_status(); }
            }
        });
    });
{/literal}
</script>
<select multiple="multiple" size="10" id="select_tabs_{$pluginid}">
{foreach key=plugin_name item=plugin from=$plugins}
    <optgroup label="{$plugin_name}">
    {foreach key=plugin_instance_name item=types from=$plugin}
    {foreach key=type_name item=type from=$types}
    {foreach key=type_instance_name item=type_instance from=$type}
        <option value="{$plugin_name}|{$plugin_instance_name}|{$type_name}|{$type_instance_name}">{$plugin_name}{if $plugin_instance_name !== '_'}-{$plugin_instance_name}{/if}/{$type_name}{if $type_instance_name !== '_'}-{$type_instance_name}{/if}</option>
    {/foreach}
    {/foreach}
    {/foreach}
    </optgroup>
{/foreach}
</select> 
<button id="save_tabs_{$pluginid}">Save tab</button>
<button class="deletetab" tabid="{$tab_id}">Delete tab</button>
<br/><br/>
